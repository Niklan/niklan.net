{% if not width and not height %}
  {% set dimensions = uri|image_dimensions(style_name) %}
  {% set width = dimensions.width %}
  {% set height = dimensions.height %}
{% endif %}
{% if style_name %}
  {% do attributes.setAttribute('src', uri|image_style(style_name)) %}
{% else %}
  {% do attributes.setAttribute('src', uri|file_url) %}
{% endif %}
{% do alt ? attributes.setAttribute('alt', alt) %}
{% do width ? attributes.setAttribute('width', width) %}
{% do height ? attributes.setAttribute('height', height) %}
{% do attributes.setAttribute('loading', loading|default('lazy')) %}
{% if srcset is not empty %}
  {% do attributes.setAttribute('sizes', sizes|default('100vw')|join(', ')) %}
  {% set srcset_array = [] %}
  {% for size, url in srcset %}
    {% set srcset_array = srcset_array|merge([url ~ ' ' ~ size]) %}
  {% endfor %}
  {% do attributes.setAttribute('srcset', srcset_array|join(', ')) %}
{% endif %}
<img{{ attributes }}/>